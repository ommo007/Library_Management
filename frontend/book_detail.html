<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="">
    <title>Book Details - Library Book Management System</title>
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./style.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="./index.html">
                <i class="fas fa-book-open me-2"></i>Library Management
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="./index.html">Books</a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="./login.html">Login</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./register.html">Register</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    
    <!-- Main Content -->
    <main class="container mt-4 mb-5">
        <nav aria-label="breadcrumb" class="mb-4">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="./index.html">Home</a></li>
                <li class="breadcrumb-item"><a href="./index.html">Books</a></li>
                <li class="breadcrumb-item active" aria-current="page">The Great Gatsby</li>
            </ol>
        </nav>

        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card">
                    <div class="card-body text-center">
                        <img src="https://placehold.co/260x360/gray/white?text=Book+Cover" alt="Book Cover" class="img-fluid rounded mb-3">
                        <span id="book-status" class="badge bg-success">Available</span>
                    </div>
                </div>
            </div>
            
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h2 class="mb-0">The Great Gatsby</h2>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <h5 class="text-muted">by F. Scott Fitzgerald</h5>
                            <div class="mb-3">
                                <span class="badge bg-secondary me-1">Fiction</span>
                                <span class="badge bg-info me-1">Classics</span>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <p><strong>ISBN:</strong> 9780743273565</p>
                                <p><strong>Publication Year:</strong> 1925</p>
                                <p><strong>Language:</strong> English</p>
                            </div>
                            <div class="col-md-6">
                                <p><strong>Section:</strong> Classics</p>
                                <p><strong>Status:</strong> <span class="text-success">Available</span></p>
                                <p><strong>Last Updated:</strong> January 1, 2023</p>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h5>Description</h5>
                            <p>Set in the Jazz Age on Long Island, the novel depicts narrator Nick Carraway's interactions with mysterious millionaire Jay Gatsby and Gatsby's obsession to reunite with his former lover, Daisy Buchanan.</p>
                        </div>
                        
                        <div class="d-flex justify-content-between">
                            <a href="./index.html" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Back to Books
                            </a>
                            <div>
                                <button class="btn btn-success me-2" id="borrow-btn">
                                    <i class="fas fa-book-reader me-1"></i>Borrow
                                </button>
                                <div class="btn-group" role="group">
                                    <button type="button" class="btn btn-warning" id="edit-btn">
                                        <i class="fas fa-edit me-1"></i>Edit
                                    </button>
                                    <button type="button" class="btn btn-danger" id="delete-btn">
                                        <i class="fas fa-trash-alt me-1"></i>Delete
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="bg-dark text-white py-4 mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Library Book Management System</h5>
                    <p class="small">Manage your library efficiently</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small">&copy; 2023 Library Book Management System. All rights reserved.</p>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script src="./main.js"></script>
    <script>
        // Book detail page specific JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Check if running as static file
            const isStaticFile = window.location.protocol === 'file:';
            
            // In real implementation, fetch book details from API using ID in URL
            if (!isStaticFile) {
                const bookId = window.location.pathname.split('/').pop();
                fetch(`/api/books/${bookId}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(book => {
                        // Update page content with book details
                        document.title = `${book.title} - Library Book Management System`;
                        document.querySelector('.card-header h2').textContent = book.title;
                        document.querySelector('.text-muted').textContent = `by ${book.author}`;
                        // Update other fields similarly
                    })
                    .catch(error => {
                        console.error('Error fetching book details:', error);
                        // Show error message to user
                    });
            }
            
            // Handle borrow button
            const borrowBtn = document.getElementById('borrow-btn');
            if (borrowBtn) {
                borrowBtn.addEventListener('click', function() {
                    if (isStaticFile) {
                        alert('Book borrowed successfully in demo mode');
                        return;
                    }
                    
                    const bookId = window.location.pathname.split('/').pop();
                    fetch(`/books/${bookId}/borrow`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Book borrowed successfully');
                            // Update UI
                            document.getElementById('book-status').className = 'badge bg-danger';
                            document.getElementById('book-status').textContent = 'Unavailable';
                        } else {
                            alert(data.message || 'Failed to borrow book');
                        }
                    })
                    .catch(error => {
                        console.error('Error borrowing book:', error);
                        alert('An error occurred while processing your request');
                    });
                });
            }
            
            // Handle delete button
            const deleteBtn = document.getElementById('delete-btn');
            if (deleteBtn) {
                deleteBtn.addEventListener('click', function() {
                    if (!confirm('Are you sure you want to delete this book? This action cannot be undone.')) {
                        return;
                    }
                    
                    if (isStaticFile) {
                        alert('Book deleted successfully in demo mode');
                        window.location.href = './index.html';
                        return;
                    }
                    
                    const bookId = window.location.pathname.split('/').pop();
                    fetch(`/books/${bookId}/delete`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Book deleted successfully');
                            window.location.href = '/books';
                        } else {
                            alert(data.message || 'Failed to delete book');
                        }
                    })
                    .catch(error => {
                        console.error('Error deleting book:', error);
                        alert('An error occurred while processing your request');
                    });
                });
            }
            
            // Handle edit button
            const editBtn = document.getElementById('edit-btn');
            if (editBtn) {
                editBtn.addEventListener('click', function() {
                    if (isStaticFile) {
                        window.location.href = './edit_book.html';
                    } else {
                        const bookId = window.location.pathname.split('/').pop();
                        window.location.href = `/books/${bookId}/edit`;
                    }
                });
            }
        });
    </script>
</body>
</html>
